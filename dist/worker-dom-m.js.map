{"version":3,"file":"worker-dom-m.js","sourceRoot":"","sources":["../src/worker-dom-m.ts"],"names":[],"mappings":"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","sourcesContent":["import { MRpc } from \"./lib/@mys-x/m-rpc/dist/main.js\";\r\nimport DOMPurify from \"./lib/dom-purify/purify.es.mjs\";\r\nimport type {\r\n  ElementTagName,\r\n  WorkerDOMMethod,\r\n  WorkerDOMObject,\r\n  WorkerDOMRef,\r\n  WorkerDOMDefaultConfig,\r\n} from \"./worker-dom-types.js\";\r\n\r\nconst DOMMethods: WorkerDOMMethod[] = [\r\n  \"create\",\r\n  \"frag\",\r\n  \"query\",\r\n  \"queryAll\",\r\n  \"childNodes\",\r\n  \"children\",\r\n  \"innerHTML\",\r\n  \"innerText\",\r\n  \"textContent\",\r\n  \"hasAttribute\",\r\n  \"getAttribute\",\r\n  \"getAttributes\",\r\n  \"setAttribute\",\r\n  \"setAttributes\",\r\n  \"removeAttribute\",\r\n  \"removeAttributes\",\r\n  \"getStyle\",\r\n  \"setStyle\",\r\n  \"append\",\r\n  \"appendChild\",\r\n];\r\n\r\n// @ts-expect-error\r\nwindow.dp = DOMPurify;\r\n\r\nclass WorkerDOMSecurityError extends Error {}\r\nclass WorkerDOM {\r\n  static get defaultConfig(): WorkerDOMDefaultConfig {\r\n    return {\r\n      allowStyling: true,\r\n      allowUnknown: false,\r\n      allowCustomElements: false,\r\n      allowedElements: new Set(\r\n        ([] as string[]).concat(\r\n          [\r\n            \"a\",\r\n            \"abbr\",\r\n            \"acronym\",\r\n            \"address\",\r\n            \"area\",\r\n            \"article\",\r\n            \"aside\",\r\n            \"audio\",\r\n            \"b\",\r\n            \"bdi\",\r\n            \"bdo\",\r\n            \"big\",\r\n            \"blink\",\r\n            \"blockquote\",\r\n            \"body\",\r\n            \"br\",\r\n            \"button\",\r\n            \"canvas\",\r\n            \"caption\",\r\n            \"center\",\r\n            \"cite\",\r\n            \"code\",\r\n            \"col\",\r\n            \"colgroup\",\r\n            \"content\",\r\n            \"data\",\r\n            \"datalist\",\r\n            \"dd\",\r\n            \"decorator\",\r\n            \"del\",\r\n            \"details\",\r\n            \"dfn\",\r\n            \"dialog\",\r\n            \"dir\",\r\n            \"div\",\r\n            \"dl\",\r\n            \"dt\",\r\n            \"element\",\r\n            \"em\",\r\n            \"fieldset\",\r\n            \"figcaption\",\r\n            \"figure\",\r\n            \"font\",\r\n            \"footer\",\r\n            \"form\",\r\n            \"h1\",\r\n            \"h2\",\r\n            \"h3\",\r\n            \"h4\",\r\n            \"h5\",\r\n            \"h6\",\r\n            \"head\",\r\n            \"header\",\r\n            \"hgroup\",\r\n            \"hr\",\r\n            \"html\",\r\n            \"i\",\r\n            \"img\",\r\n            \"input\",\r\n            \"ins\",\r\n            \"kbd\",\r\n            \"label\",\r\n            \"legend\",\r\n            \"li\",\r\n            \"main\",\r\n            \"map\",\r\n            \"mark\",\r\n            \"marquee\",\r\n            \"menu\",\r\n            \"menuitem\",\r\n            \"meter\",\r\n            \"nav\",\r\n            \"nobr\",\r\n            \"ol\",\r\n            \"optgroup\",\r\n            \"option\",\r\n            \"output\",\r\n            \"p\",\r\n            \"picture\",\r\n            \"pre\",\r\n            \"progress\",\r\n            \"q\",\r\n            \"rp\",\r\n            \"rt\",\r\n            \"ruby\",\r\n            \"s\",\r\n            \"samp\",\r\n            \"section\",\r\n            \"select\",\r\n            \"shadow\",\r\n            \"small\",\r\n            \"source\",\r\n            \"spacer\",\r\n            \"span\",\r\n            \"strike\",\r\n            \"strong\",\r\n            \"style\",\r\n            \"sub\",\r\n            \"summary\",\r\n            \"sup\",\r\n            \"table\",\r\n            \"tbody\",\r\n            \"td\",\r\n            \"template\",\r\n            \"textarea\",\r\n            \"tfoot\",\r\n            \"th\",\r\n            \"thead\",\r\n            \"time\",\r\n            \"tr\",\r\n            \"track\",\r\n            \"tt\",\r\n            \"u\",\r\n            \"ul\",\r\n            \"var\",\r\n            \"video\",\r\n            \"wbr\",\r\n          ],\r\n          [\r\n            \"svg\",\r\n            \"a\",\r\n            \"altglyph\",\r\n            \"altglyphdef\",\r\n            \"altglyphitem\",\r\n            \"animatecolor\",\r\n            \"animatemotion\",\r\n            \"animatetransform\",\r\n            \"circle\",\r\n            \"clippath\",\r\n            \"defs\",\r\n            \"desc\",\r\n            \"ellipse\",\r\n            \"filter\",\r\n            \"font\",\r\n            \"g\",\r\n            \"glyph\",\r\n            \"glyphref\",\r\n            \"hkern\",\r\n            \"image\",\r\n            \"line\",\r\n            \"lineargradient\",\r\n            \"marker\",\r\n            \"mask\",\r\n            \"metadata\",\r\n            \"mpath\",\r\n            \"path\",\r\n            \"pattern\",\r\n            \"polygon\",\r\n            \"polyline\",\r\n            \"radialgradient\",\r\n            \"rect\",\r\n            \"stop\",\r\n            \"style\",\r\n            \"switch\",\r\n            \"symbol\",\r\n            \"text\",\r\n            \"textpath\",\r\n            \"title\",\r\n            \"tref\",\r\n            \"tspan\",\r\n            \"view\",\r\n            \"vkern\",\r\n          ]\r\n        )\r\n      ),\r\n      forbiddenElements: new Set([\"script\", \"iframe\", \"object\", \"embed\", \"link\", \"meta\"]),\r\n      forbiddenAttributes: new Set([\"src\", \"href\", \"action\"]),\r\n      forbiddenAttributesRgx: [/^\\s*on\\w+\\s*$/i],\r\n      allowInnerHTML: false,\r\n    };\r\n  }\r\n\r\n  #id = -1;\r\n  root: Element;\r\n  worker: Worker;\r\n  commChannel: MRpc;\r\n  #uuid: string = crypto.randomUUID();\r\n  config: typeof WorkerDOM.defaultConfig;\r\n  refs: Map<WorkerDOMRef, WorkerDOMObject>;\r\n  irefs: Map<WorkerDOMObject, WorkerDOMRef>;\r\n  constructor({\r\n    worker,\r\n    root,\r\n    config = {},\r\n  }: {\r\n    worker: Worker;\r\n    root?: Element;\r\n    config?: Partial<WorkerDOMDefaultConfig>;\r\n  }) {\r\n    this.config = WorkerDOM.defaultConfig;\r\n    this.worker = worker;\r\n    this.refs = new Map();\r\n    this.irefs = new Map();\r\n    this.commChannel = new MRpc(worker);\r\n\r\n    const _root = (root || document.createElement(\"main\")) as Element;\r\n    if (!(_root instanceof Element)) throw new Error(\"Failed to create root element.\");\r\n\r\n    this.root = _root;\r\n    this.#referenceTo(_root);\r\n    this.#setupCommunications();\r\n    this.#initialiseConfig(config);\r\n  }\r\n\r\n  #initialiseConfig(config: Partial<WorkerDOMDefaultConfig>) {\r\n    const {\r\n      allowStyling,\r\n      allowUnknown,\r\n      allowCustomElements,\r\n      allowedElements,\r\n      forbiddenElements,\r\n      forbiddenAttributes,\r\n      forbiddenAttributesRgx,\r\n      allowInnerHTML,\r\n    } = config;\r\n    if (allowStyling != null) this.config.allowStyling = !!allowStyling;\r\n    if (allowUnknown != null) this.config.allowUnknown = !!allowUnknown;\r\n    if (allowCustomElements != null) this.config.allowCustomElements = !!allowCustomElements;\r\n    if (allowedElements != null) this.config.allowedElements = new Set(allowedElements);\r\n    if (forbiddenElements != null) this.config.forbiddenElements = new Set(forbiddenElements);\r\n    if (forbiddenAttributes != null) this.config.forbiddenAttributes = new Set(forbiddenAttributes);\r\n    if (forbiddenAttributesRgx != null) {\r\n      this.config.forbiddenAttributesRgx = Array.from(forbiddenAttributesRgx).filter(\r\n        (el) => el instanceof RegExp\r\n      );\r\n    }\r\n    if (allowInnerHTML != null) this.config.allowInnerHTML = !!allowInnerHTML;\r\n  }\r\n\r\n  #isValidAttributeName(name: string) {\r\n    if (this.config.forbiddenAttributes.has(name)) return false;\r\n    if (this.config.forbiddenAttributesRgx.some((el) => el.test(name))) return false;\r\n    return true;\r\n  }\r\n\r\n  #isAccessibleDOMObject(domObject: WorkerDOMObject | string) {\r\n    if (typeof domObject === \"string\") {\r\n      const [tagName, is] = domObject.split(\",\");\r\n      const isCustomElement = /^[a-z][a-z0-9]*(?:-[a-z][a-z0-9]*)*$/i.test(tagName);\r\n      if (is != null && !this.config.allowCustomElements) return false;\r\n      if (this.config.forbiddenElements.has(tagName)) return false;\r\n      if (this.config.allowedElements.has(tagName)) return true;\r\n      if (isCustomElement && this.config.allowCustomElements) return true;\r\n\r\n      return this.config.allowUnknown;\r\n    }\r\n\r\n    if (domObject === this.root) return true;\r\n\r\n    if (domObject instanceof DocumentFragment) return true;\r\n    if (domObject.nodeType === Node.TEXT_NODE) return true;\r\n    if (Object.getPrototypeOf(domObject) === Node.prototype) return domObject.nodeName === \"#text\";\r\n\r\n    const tagName = (domObject as Element).tagName.toLowerCase();\r\n    const isCustomElement = /^[a-z][a-z0-9]*(?:-[a-z][a-z0-9]*)*$/i.test(tagName);\r\n    if (this.config.forbiddenElements.has(tagName)) return false;\r\n    if (this.config.allowedElements.has(tagName)) return true;\r\n    if (isCustomElement && this.config.allowCustomElements) return true;\r\n\r\n    return this.config.allowUnknown;\r\n  }\r\n\r\n  #referenceTo(domObject: WorkerDOMObject) {\r\n    if (!this.#isAccessibleDOMObject(domObject))\r\n      throw new WorkerDOMSecurityError(\"Access denied to DOM object.\");\r\n    const ref = this.irefs.get(domObject);\r\n    return ref === undefined ? this.#setRef(++this.#id, domObject) : ref;\r\n  }\r\n\r\n  #setRef(ref: WorkerDOMRef, domObject: WorkerDOMObject) {\r\n    if (!this.#isAccessibleDOMObject(domObject))\r\n      throw new WorkerDOMSecurityError(\"Access denied to DOM object.\");\r\n    this.refs.set(ref, domObject);\r\n    this.irefs.set(domObject, ref);\r\n    return ref;\r\n  }\r\n\r\n  #setupCommunications() {\r\n    const noop = () => {};\r\n    // biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n    const obj: { [m in WorkerDOMMethod]: (...args: any[]) => any } = {\r\n      create: noop,\r\n      frag: noop,\r\n      query: noop,\r\n      queryAll: noop,\r\n      childNodes: noop,\r\n      children: noop,\r\n      innerHTML: noop,\r\n      innerText: noop,\r\n      textContent: noop,\r\n      hasAttribute: noop,\r\n      getAttribute: noop,\r\n      getAttributes: noop,\r\n      setAttribute: noop,\r\n      setAttributes: noop,\r\n      removeAttribute: noop,\r\n      removeAttributes: noop,\r\n      getStyle: noop,\r\n      setStyle: noop,\r\n      append: noop,\r\n      appendChild: noop,\r\n    };\r\n\r\n    for (const method of DOMMethods) obj[method] = this[method as WorkerDOMMethod].bind(this);\r\n    this.commChannel.defineLocalFns(obj);\r\n  }\r\n\r\n  create(tagName: ElementTagName | ElementTagName[]): WorkerDOMRef[] {\r\n    const elements = Array.isArray(tagName) ? tagName : [tagName || \"div\"];\r\n    const result: WorkerDOMRef[] = new Array(elements.length);\r\n\r\n    for (let i = 0; i < elements.length; i++) {\r\n      if (typeof elements[i] !== \"string\") {\r\n        throw new TypeError(\"`tagName` must be a string or an array of strings.\");\r\n      }\r\n      if (!this.#isAccessibleDOMObject(elements[i])) {\r\n        throw new WorkerDOMSecurityError(\r\n          `Creation of element <${elements[i].replace(\r\n            /\\s*\\,\\s*/,\r\n            \", \"\r\n          )}> is not allowed by the WorkerDOM configuration.`\r\n        );\r\n      }\r\n      const [name, is] = elements[i].split(\",\");\r\n      const element = is ? document.createElement(name, { is }) : document.createElement(name);\r\n      const id = ++this.#id;\r\n\r\n      this.#setRef(id, element);\r\n      result[i] = id;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  frag(): WorkerDOMRef {\r\n    const id = ++this.#id;\r\n    const frag = document.createDocumentFragment();\r\n\r\n    this.#setRef(id, frag);\r\n    return id;\r\n  }\r\n\r\n  query(parentRef: WorkerDOMRef, selector: string): WorkerDOMRef | null {\r\n    const parent = this.refs.get(parentRef == null ? 0 : parentRef) as Element | DocumentFragment;\r\n    if (!(parent instanceof Element || parent instanceof DocumentFragment)) {\r\n      throw new TypeError(\"`parentRef` did not refer to a queryable DOM object.\");\r\n    }\r\n\r\n    const target = parent.querySelector(selector);\r\n    if (target === null) return null;\r\n    return this.#referenceTo(target);\r\n  }\r\n\r\n  queryAll(parentRef: WorkerDOMRef, selector: string): WorkerDOMRef[] {\r\n    const parent = this.refs.get(parentRef == null ? 0 : parentRef) as Element | DocumentFragment;\r\n    if (!(parent instanceof Element || parent instanceof DocumentFragment)) {\r\n      throw new TypeError(\"`parentRef` did not refer to a queryable DOM object.\");\r\n    }\r\n\r\n    const targets = parent.querySelectorAll(selector);\r\n    return Array.from(targets, (t) => this.#referenceTo(t));\r\n  }\r\n\r\n  childNodes(ref: WorkerDOMRef): WorkerDOMRef[] {\r\n    const target = this.refs.get(ref);\r\n    if (!(target instanceof Node)) {\r\n      throw new TypeError(\"`ref` did not refer to a Node instance.\");\r\n    }\r\n\r\n    return Array.from(target.childNodes, (t) => this.#referenceTo(t));\r\n  }\r\n\r\n  children(ref: WorkerDOMRef): WorkerDOMRef[] {\r\n    const target = this.refs.get(ref);\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    return Array.from(target.children, (t) => this.#referenceTo(t));\r\n  }\r\n\r\n  innerHTML(ref: WorkerDOMRef, text?: string): string {\r\n    const target = this.refs.get(ref);\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    if (text != null) {\r\n      if (this.config.allowInnerHTML) target.innerHTML = DOMPurify.sanitize(text);\r\n      else\r\n        throw new WorkerDOMSecurityError(\r\n          \"Setting innerHTML is not permitted by the WorkerDOM configuration.\"\r\n        );\r\n    }\r\n    return target.innerHTML;\r\n  }\r\n\r\n  innerText(ref: WorkerDOMRef, text?: string): string {\r\n    const target = this.refs.get(ref) as HTMLElement;\r\n    if (!(target instanceof HTMLElement)) {\r\n      throw new TypeError(\"`ref` did not refer to an HTMLElement instance.\");\r\n    }\r\n\r\n    if (text !== undefined) target.innerText = text;\r\n    return target.innerText;\r\n  }\r\n\r\n  textContent(ref: WorkerDOMRef, text?: string): string | null {\r\n    const target = this.refs.get(ref) as Node;\r\n    if (!(target instanceof Node)) {\r\n      throw new TypeError(\"`ref` did not refer to a Node instance.\");\r\n    }\r\n\r\n    if (text !== undefined) target.textContent = text;\r\n    return target.textContent;\r\n  }\r\n\r\n  hasAttribute(ref: WorkerDOMRef, attribute: string): boolean {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    if (!this.#isValidAttributeName(attribute)) {\r\n      throw new WorkerDOMSecurityError(\r\n        `Access to attribute \"${attribute}\" is not allowed by the WorkerDOM configuration.`\r\n      );\r\n    }\r\n\r\n    return target.hasAttribute(attribute);\r\n  }\r\n\r\n  getAttribute(ref: WorkerDOMRef, attribute: string): string | null {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    if (!this.#isValidAttributeName(attribute)) {\r\n      throw new WorkerDOMSecurityError(\r\n        `Access to attribute \"${attribute}\" is not allowed by the WorkerDOM configuration.`\r\n      );\r\n    }\r\n\r\n    return target.getAttribute(attribute);\r\n  }\r\n\r\n  getAttributes(ref: WorkerDOMRef): Record<string, string | null> {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    const result: { [index: string]: string | null } = {};\r\n    const attributes = Array.from(target.attributes);\r\n\r\n    for (let i = 0; i < attributes.length; i++) {\r\n      const attribute = attributes[i];\r\n      const name = attribute.nodeName;\r\n\r\n      if (!this.#isValidAttributeName(name)) {\r\n        throw new WorkerDOMSecurityError(\r\n          `Access to attribute \"${name}\" is not allowed by the WorkerDOM configuration.`\r\n        );\r\n      }\r\n\r\n      result[name] = attribute.nodeValue;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  setAttribute(ref: WorkerDOMRef, attribute: string, value: string): void {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    if (!this.#isValidAttributeName(attribute)) {\r\n      throw new WorkerDOMSecurityError(\r\n        `Access to attribute \"${attribute}\" is not allowed by the WorkerDOM configuration.`\r\n      );\r\n    }\r\n\r\n    target.setAttribute(attribute, value);\r\n  }\r\n\r\n  setAttributes(ref: WorkerDOMRef, attributes: Record<string, string | null>): void {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    for (const attribute in attributes) {\r\n      if (!this.#isValidAttributeName(attribute)) {\r\n        throw new WorkerDOMSecurityError(\r\n          `Access to attribute \"${attribute}\" is not allowed by the WorkerDOM configuration.`\r\n        );\r\n      }\r\n\r\n      const value = attributes[attribute];\r\n      if (value === null) target.removeAttribute(attribute);\r\n      else target.setAttribute(attribute, value);\r\n    }\r\n  }\r\n\r\n  removeAttribute(ref: WorkerDOMRef, attribute: string): void {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    if (!this.#isValidAttributeName(attribute)) {\r\n      throw new WorkerDOMSecurityError(\r\n        `Access to attribute \"${attribute}\" is not allowed by the WorkerDOM configuration.`\r\n      );\r\n    }\r\n\r\n    target.removeAttribute(attribute);\r\n  }\r\n\r\n  removeAttributes(ref: WorkerDOMRef, attributes: string[]): void {\r\n    const target = this.refs.get(ref) as Element;\r\n    if (!(target instanceof Element)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element instance.\");\r\n    }\r\n\r\n    for (let i = 0; i < attributes.length; i++) {\r\n      const attribute = attributes[i];\r\n\r\n      if (!this.#isValidAttributeName(attribute)) {\r\n        throw new WorkerDOMSecurityError(\r\n          `Access to attribute \"${attribute}\" is not allowed by the WorkerDOM configuration.`\r\n        );\r\n      }\r\n\r\n      target.removeAttribute(attribute);\r\n    }\r\n  }\r\n\r\n  getStyle(ref: WorkerDOMRef, computed = false): Record<string, string> {\r\n    if (!this.config.allowStyling) {\r\n      throw new WorkerDOMSecurityError(\r\n        \"Access to style is not allowed by the WorkerDOM configuration.\"\r\n      );\r\n    }\r\n\r\n    const target = this.refs.get(ref) as HTMLElement | SVGElement;\r\n    if (!(target instanceof HTMLElement || target instanceof SVGElement)) {\r\n      throw new TypeError(\"`ref` did not refer to an HTMLElement or SVGElement instance.\");\r\n    }\r\n\r\n    const style = target.style;\r\n    const props = [\r\n      ...Object.getOwnPropertyNames(style),\r\n      ...Object.getOwnPropertyNames(Object.getPrototypeOf(style)),\r\n    ];\r\n    const result: { [index: string]: string } = {};\r\n\r\n    for (let i = 0; i < props.length; i++) {\r\n      // @ts-expect-error\r\n      const value: string = style[props[i]];\r\n      if (typeof value === \"string\") result[props[i]] = value;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  setStyle(ref: WorkerDOMRef, declaration: Record<string, string>): void {\r\n    if (!this.config.allowStyling) {\r\n      throw new WorkerDOMSecurityError(\r\n        \"Access to style is not allowed by the WorkerDOM configuration.\"\r\n      );\r\n    }\r\n\r\n    const target = this.refs.get(ref) as HTMLElement | SVGElement;\r\n    if (!(target instanceof HTMLElement || target instanceof SVGElement)) {\r\n      throw new TypeError(\"`ref` did not refer to an HTMLElement or SVGElement instance.\");\r\n    }\r\n\r\n    const style = target.style;\r\n    // @ts-expect-error\r\n    for (const prop in declaration) style[prop] = declaration[prop];\r\n  }\r\n\r\n  append(ref: WorkerDOMRef, ...children: (WorkerDOMRef | string)[]): void {\r\n    const target = this.refs.get(ref) as Element | DocumentFragment;\r\n    if (!(target instanceof Element || target instanceof DocumentFragment)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element or DocumentFragment instance.\");\r\n    }\r\n    for (const childRef of children) {\r\n      if (typeof childRef === \"string\") {\r\n        target.append(childRef);\r\n        continue;\r\n      }\r\n\r\n      const child = this.refs.get(childRef);\r\n      if (!(child instanceof Node)) {\r\n        throw new TypeError(\"`children` must refer to Node instances.\");\r\n      }\r\n      if (!this.#isAccessibleDOMObject(child)) {\r\n        throw new WorkerDOMSecurityError(\"Access denied to child DOM object.\");\r\n      }\r\n      target.append(child);\r\n    }\r\n  }\r\n\r\n  appendChild(ref: WorkerDOMRef, childRef: WorkerDOMRef): void {\r\n    const target = this.refs.get(ref) as Element | DocumentFragment;\r\n    if (!(target instanceof Element || target instanceof DocumentFragment)) {\r\n      throw new TypeError(\"`ref` did not refer to an Element or DocumentFragment instance.\");\r\n    }\r\n    const child = this.refs.get(childRef);\r\n    if (!(child instanceof Node)) {\r\n      throw new TypeError(\"`childRef` must refer to a Node instance.\");\r\n    }\r\n    if (!this.#isAccessibleDOMObject(child)) {\r\n      throw new WorkerDOMSecurityError(\"Access denied to child DOM object.\");\r\n    }\r\n    target.appendChild(child);\r\n  }\r\n}\r\n\r\nexport { WorkerDOM, WorkerDOM as default };\r\n"]}